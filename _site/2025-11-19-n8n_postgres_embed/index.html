<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
<link rel="manifest" href="/assets/img/site.webmanifest">
<link rel="mask-icon" href="/assets/img/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Set up n8n and postgres for Retrieval Augmented Generation (RAG) using the local vector database</title>

  
  <meta name="author" content="Yuanpeng Zhang">
  

  <meta name="description" content="In this post, I will put down the notes for configuring the postgres connection in n8n. At the end of the day, the purpose is to create a workflow for the Retrieval Augmented Generation (RAG). In Ref. [1], we can find a workflow template for scraping the n8n documentation, embedding...">

  

  

  <link rel="alternate" type="application/rss+xml" title="Yuanpeng's Blog" href="http://localhost:4000/feed.xml">

  

  

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-44PBCNZ80G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-44PBCNZ80G');
</script>

  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Yuanpeng's Blog">
  <meta property="og:title" content="Set up n8n and postgres for Retrieval Augmented Generation (RAG) using the local vector database">
  <meta property="og:description" content="In this post, I will put down the notes for configuring the postgres connection in n8n. At the end of the day, the purpose is to create a workflow for the Retrieval Augmented Generation (RAG). In Ref. [1], we can find a workflow template for scraping the n8n documentation, embedding...">

  
  <meta property="og:image" content="http://localhost:4000/assets/img/mountain.png">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Yuanpeng Zhang">
  <meta property="og:article:published_time" content="2025-11-19T00:00:00-05:00">
  <meta property="og:url" content="http://localhost:4000/2025-11-19-n8n_postgres_embed/">
  <link rel="canonical" href="http://localhost:4000/2025-11-19-n8n_postgres_embed/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="Set up n8n and postgres for Retrieval Augmented Generation (RAG) using the local vector database">
  <meta property="twitter:description" content="In this post, I will put down the notes for configuring the postgres connection in n8n. At the end of the day, the purpose is to create a workflow for the Retrieval Augmented Generation (RAG). In Ref. [1], we can find a workflow template for scraping the n8n documentation, embedding...">

  
  <meta name="twitter:image" content="http://localhost:4000/assets/img/mountain.png">
  

  


  

  

<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script async='async' src='https://www.gstatic.com/external_hosted/clipboardjs/clipboard.min.js'></script>
<script src='https://unpkg.com/sweetalert@2.1.2/dist/sweetalert.min.js'></script>
<script language='JavaScript'>
  function copytoclipboard(containerid){
    if (document.selection) {
      var range = document.body.createTextRange();
      range.moveToElementText(document.getElementById(containerid));
      range.select().createTextRange();
      document.execCommand("copy");
    } else if (window.getSelection) {
      var range = document.createRange();
      range.selectNode(document.getElementById(containerid));
      var selection = window.getSelection() // get Selection object from currently user selected text
      selection.removeAllRanges() // unselect any user selected text (if any)
      selection.addRange(range) // add range to Selection object to select it
      document.execCommand("copy");
      //alert("Codes snippet copied to clipboard!")
      swal({
      title: "",
      text: "Codes snippet copied to clipboard!",
      icon: "success",
      });
    }
  }
</script>
<script defer src="https://umm.iris-home.net/script.js" data-website-id="f40cd621-831a-49d1-b675-c998d596eb96"></script>
</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand navbar-brand-logo" href="http://localhost:4000/"><img alt="Yuanpeng's Blog Logo" src="/assets/img/home.png"/></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
              <a class="nav-link" href="/search">üîçSearch</a></li>
          <li class="nav-item">
              <a class="nav-link" href="/about">About</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Posts</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/all_posts">All posts</a>
                    <a class="dropdown-item" href="/archive">Archive</a>
                    <a class="dropdown-item" href="/tags">Tags</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Academic</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="/nav_pages/publications">Publications</a>
                    <a class="dropdown-item" href="/nav_pages/lnotes">Learning Notes</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More Links</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown"><a target="_blank" class="dropdown-item" href="https://www.ornl.gov/staff-profile/yuanpeng-zhang">ORNL Profile</a>
								  <a target="_blank" class="dropdown-item" href="https://me.iris-home.net">My Homepage</a>
								  <a target="_blank" class="dropdown-item" href="https://scholar.google.com/citations?user=NgqIgO0AAAAJ&hl=en">Google Scholar</a>
								  <a target="_blank" class="dropdown-item" href="https://orcid.org/0000-0003-4224-3361">ORCID</a>
								  <a target="_blank" class="dropdown-item" href="https://rmcprofile.ornl.gov/">RMCProfile</a>
								  <a target="_blank" class="dropdown-item" href="https://dh.iris-home.net">My Dashboard</a>
								  
                    <a class="dropdown-item" href="https://page.iris-2020.net">My Collection</a><a target="_blank" class="dropdown-item" href="https://github.com/Kvieta1990">GitHub Profile</a>
								  <a target="_blank" class="dropdown-item" href="https://github.com/Kvieta1990/Kvieta1990.github.io">Blog Repo</a>
								  <a target="_blank" class="dropdown-item" href="https://mybinder.org/v2/gh/Kvieta1990/Jup_Notes/master">Jupyter Binder</a>
								  <a target="_blank" class="dropdown-item" href="https://github.com/Kvieta1990/Iris">More Notes</a>
								  
            </div>
          </li>
        
          <li class="nav-item">
              <a class="nav-link" href="/updates">Updates</a></li>
          <li class="nav-item"><a target="_blank" class="nav-link" href="https://flarum.iris-home.net">Forum</a>
					  </li>
          <li class="nav-item">
              <a class="nav-link" href="/contact">Contact</a></li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border" id="others">
      </div>
    </div>
    <div class="avatar-container">
      <div class="avatar-img-border">
					<div class="avatar-adjust" id="safari">
				  </div>
      </div>
    </div>
  

<script>
function myFunction() {
		return '<a href="http://localhost:4000/"><img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/mountain.png" />';
}
let safariAgent = navigator.userAgent.indexOf("Safari") > -1;
let chromeAgent = navigator.userAgent.indexOf("Chrome") > -1;
if (chromeAgent) {
  document.getElementById("others").innerHTML = myFunction();
} else if (safariAgent) {
  document.getElementById("safari").innerHTML = myFunction();
} else {
  document.getElementById("others").innerHTML = myFunction();
}

</script>

</nav>


  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">
<script defer src="https://umm.iris-home.net/script.js" data-website-id="f40cd621-831a-49d1-b675-c998d596eb96"></script>

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-10 offset-xl-1 col-lg-12 offset-lg-1">
        <div class="post-heading">
						<h1>Set up n8n and postgres for Retrieval Augmented Generation (RAG) using the local vector database</h1>
          

          
					<span class="post-meta">Posted on November 19, 2025, by Yuanpeng Zhang</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-10 offset-xl-1 col-lg-12 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <style>
    .faq-container {
        margin: 0 auto;
    }
    .faq-question {
        margin-bottom: 10px;
        font-weight: bold;
        cursor: pointer;
    }
    .faq-answer {
        display: none;
        margin-bottom: 20px;
    }
    .callout {
        background-color: #e8f4fd; /* Light blue background */
        border-left: 5px solid #007BFF; /* Blue accent on the left */
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow for depth */
        font-family: Arial, sans-serif; /* Ensuring the font is consistent */
    }
    .multiline-span {
        display: block; /* or display: inline-block; */
    }
</style>

<p align="center">
<img src="/assets/img/posts/n8n.png" style="border:none;" width="200" alt="n8n" title="n8n" />
</p>

<p>In this post, I will put down the notes for configuring the <code class="language-plaintext highlighter-rouge">postgres</code> connection in <code class="language-plaintext highlighter-rouge">n8n</code>. At the end of the day, the purpose is to create a workflow for the Retrieval Augmented Generation (RAG). In Ref. [1], we can find a workflow template for scraping the <code class="language-plaintext highlighter-rouge">n8n</code> documentation, embedding the scraped contents and saving it to a vector database (so that RAG can be realized with LLM models). The embedding engine used there is Gemini and the vector database for storing the embedded contents is a temporary one. This means, any time the <code class="language-plaintext highlighter-rouge">n8n</code> instance is restarted, the saved vector databases will be gone and we need to run the scraping and embedding workflow again. This is not an option for the deployment as a product, and it is the purpose of this blog to set up a database server running locally so that <code class="language-plaintext highlighter-rouge">n8n</code> can store the embedded contents in the local server.</p>

<p>I was following the instructions in Ref. [2] for setting up the local <code class="language-plaintext highlighter-rouge">postgres</code> server with the <code class="language-plaintext highlighter-rouge">pgvector</code> extension (for vector database). Here below is the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file being used,</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">networks</span><span class="pi">:</span>
  <span class="na">n8n_local</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">pgvector/pgvector:pg17</span> <span class="c1"># PostgreSQL with pgvector support</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">pgvector-db</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">postgres</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">&lt;my_password&gt;</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">vec_emb</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">n8n_local</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">pgdata:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./postgres/schema.sql:/docker-entrypoint-initdb.d/schema.sql</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">pgdata</span><span class="pi">:</span> <span class="c1"># Stores data outside the container to ensure persistence</span>
</code></pre></div></div>

<p>Parallel to the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file, we should create a directory called <code class="language-plaintext highlighter-rouge">postgres</code> inside which we want to put in a file <code class="language-plaintext highlighter-rouge">schema.sql</code> with the following contents (for setting up the <code class="language-plaintext highlighter-rouge">pgvector</code> extension and a sample database),</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Enable pgvector extension
CREATE EXTENSION IF NOT EXISTS vector;

-- Create sample table
CREATE TABLE items (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    item_data JSONB,
    embedding vector(1536) -- vector data
</code></pre></div></div>

<p>Here, we want to make sure setting a secure password to replace <code class="language-plaintext highlighter-rouge">&lt;my_password&gt;</code> in the <code class="language-plaintext highlighter-rouge">YAML</code> file above. To start the container, run,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker compose up <span class="nt">-d</span>
</code></pre></div></div>

<p>Later on, we can worry about getting rid of <code class="language-plaintext highlighter-rouge">sudo</code> from the command, which may not be necessary at this stage.</p>

<p>Next, we want to set up <code class="language-plaintext highlighter-rouge">n8n</code>. Here below is the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file being used,</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">networks</span><span class="pi">:</span>
    <span class="na">n8n_local</span><span class="pi">:</span>
        <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">services</span><span class="pi">:</span>
    <span class="na">n8n</span><span class="pi">:</span>
        <span class="na">container_name</span><span class="pi">:</span> <span class="s">${CONTAINER_NAME}</span>
        <span class="na">deploy</span><span class="pi">:</span>
            <span class="na">resources</span><span class="pi">:</span>
                <span class="na">limits</span><span class="pi">:</span>
                    <span class="na">cpus</span><span class="pi">:</span> <span class="s">${CPUS}</span>
                    <span class="na">memory</span><span class="pi">:</span> <span class="s">${MEMORY_LIMIT}</span>
        <span class="na">environment</span><span class="pi">:</span>
            <span class="na">N8N_SECURE_COOKIE</span><span class="pi">:</span> <span class="no">false</span>
            <span class="na">N8N_EDITOR_BASE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://nen.ornl.gov"</span>
            <span class="na">WEBHOOK_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://nen.ornl.gov"</span>
        <span class="na">networks</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">n8n_local</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">n8nio/n8n:1.120.3</span>
        <span class="na">labels</span><span class="pi">:</span>
            <span class="na">createdBy</span><span class="pi">:</span> <span class="s">Apps</span>
        <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">${HOST_IP}:${PANEL_APP_PORT_HTTP}:5678</span>
        <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
        <span class="na">volumes</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">./data:/home/node/.n8n</span>
            <span class="pi">-</span> <span class="s">./local-files:/files</span>
</code></pre></div></div>

<p>Parallel to the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file, we need to create the <code class="language-plaintext highlighter-rouge">.env</code> file and populate it with the following contents,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER_NAME="addie-n8n"
CPUS=0
HOST_IP=""
MEMORY_LIMIT=0
PANEL_APP_PORT_HTTP=5678
</code></pre></div></div>

<p>where the <code class="language-plaintext highlighter-rouge">CONTAINER_NAME</code> can be an arbitrary name meaningful to ourselves. All the other entries can be left untouched, unless we have to ‚Äì e.g., if the port <code class="language-plaintext highlighter-rouge">5678</code> is already in use, we may need to change it to something else. We also need to create a folder <code class="language-plaintext highlighter-rouge">local-files</code> sitting parallel to the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file. To start the container, run,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker compose up <span class="nt">-d</span>
</code></pre></div></div>

<p>Here, I am omitting the <code class="language-plaintext highlighter-rouge">sudo</code> in the docker command which by default would be required. But in my case, initially for some reason, the docker container failed to start up complaining about the permission issue for the <code class="language-plaintext highlighter-rouge">data</code> directory created automatically while running the docker compose command above. To solve the issue, I was referring to Ref. [3], but meanwhile, I was also following the instructions in Ref. [4] to remove the need for the <code class="language-plaintext highlighter-rouge">sudo</code> in docker compose command. So, I am not sure which one actually solved the issue so I just put down the notes for both here in the post for future reference. Once the <code class="language-plaintext highlighter-rouge">n8n</code> container is up running, we need to worry about connecting to the service from externally in a secure way. For such a purpose, we need to set up the web service on the server where <code class="language-plaintext highlighter-rouge">n8n</code> is running. Here I am using <code class="language-plaintext highlighter-rouge">nginx</code> for the reverse proxy. Some detailed notes regarding the <code class="language-plaintext highlighter-rouge">nginx</code> setup together with the SSL certificate for secure connections can be found in Ref. [5]. Here I am setting up the service on the ORNL research cloud virtual machine and therefore the domain name setup is very specific to ORNL. Basically, we can go to <a href="https://devices.ornl.gov">https://devices.ornl.gov</a> and assign aliases of the domain name to the machine. <code class="language-plaintext highlighter-rouge">Aliase</code> here just means another sub-level domain name for the machine. For example, one of the domain names for ORNL is <code class="language-plaintext highlighter-rouge">ornl.gov</code> and we can have <code class="language-plaintext highlighter-rouge">addie.ornl.gov</code> and <code class="language-plaintext highlighter-rouge">nen.ornl.gov</code> as the sub-level domain names pointing to the same machine. Once we have the domain name, we can follow the instructions in Ref. [5] for setting up <code class="language-plaintext highlighter-rouge">nginx</code> + <code class="language-plaintext highlighter-rouge">SSL</code> for a secure web connection from the internet. For sure, the port <code class="language-plaintext highlighter-rouge">80</code> (for <code class="language-plaintext highlighter-rouge">HTTP</code> traffic, which actually will be redirected to <code class="language-plaintext highlighter-rouge">443</code> through the <code class="language-plaintext highlighter-rouge">nginx</code> configuration) and <code class="language-plaintext highlighter-rouge">443</code> (for <code class="language-plaintext highlighter-rouge">HTTPS</code> traffic) for the machine hosting the services should be opened ‚Äì for ORNL research cloud instances, we need to submit exception request form and the cyber security team will perform security check for the machine. The ports can be opened only if the security requirements are met. Here I am backing up the <code class="language-plaintext highlighter-rouge">nginx</code> configuration for future reference,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;
error_log /var/log/nginx/error.log;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
    # multi_accept on;
}

http {
    log_format main  '$remote_addr - $remote_user [$time_local] "$request" '
        '$status $body_bytes_sent "$http_referer" '
        '"$http_user_agent" "$http_x_forwarded_for"';

    client_max_body_size 200M;
    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    add_header X-Frame-Options DENY;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_prefer_server_ciphers on;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    include /etc/nginx/conf.d/*.conf;

    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }

    server {
        listen 80;
        server_name nen.ornl.gov;
        add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains; preload;' always;
        add_header X-Frame-Options DENY;
        add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains; preload;' always;
        add_header X-Frame-Options "SAMEORIGIN";
        return 301 https://nen.ornl.gov$request_uri;
    }

    map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
    }

    server {
        listen       443 ssl;
        server_name  nen.ornl.gov;
        root         /usr/share/nginx/html;

        add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains; preload;' always;
        add_header X-Frame-Options "DENY";

        ssl_certificate "/home/cloud/packages/n8n/nen.pem";
        ssl_certificate_key "/home/cloud/packages/n8n/nen.key";

        location / {
            proxy_pass http://localhost:5678;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            proxy_pass_request_headers on;
            add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains; preload;' always;
            add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate" always;
            add_header Pragma "no-cache" always;
            add_header Expires "0" always;
            add_header X-Frame-Options "SAMEORIGIN";
            add_header X-Frame-Options "DENY" always;
            proxy_set_header X-Frame-Options "SAMEORIGIN";
            client_max_body_size 50M;
            proxy_set_header Connection "";
            proxy_set_header Host $http_host;
            proxy_buffers 256 16k;
            proxy_buffer_size 16k;
            proxy_read_timeout 600s;
            proxy_cache_revalidate on;
            proxy_cache_min_uses 2;
            proxy_cache_use_stale timeout;
            proxy_cache_lock on;
            proxy_http_version 1.1;
        }

        error_page 404 /404.html;
            location = /404.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }
}
</code></pre></div></div>

<p>The following two lines in the <code class="language-plaintext highlighter-rouge">nginx</code> configuration above is important regarding the websocket connection [6],</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
</code></pre></div></div>

<p>without which, in my case, the <code class="language-plaintext highlighter-rouge">n8n</code> will complain about <code class="language-plaintext highlighter-rouge">connection lost</code> in the workflow editing interface.</p>

<p>Now, we have both docker container up running and next we want to worry about the connection between the two ‚Äì our <code class="language-plaintext highlighter-rouge">n8n</code> instance need to talk to the <code class="language-plaintext highlighter-rouge">postgres</code> database for vector database insertion and query. If it is possible to open the port for <code class="language-plaintext highlighter-rouge">postgres</code> (by default, it is <code class="language-plaintext highlighter-rouge">5432</code>) on our server, we can configure the connection in <code class="language-plaintext highlighter-rouge">n8n</code> by using the out-facing address (domain name or IP address) of our server and the port (e.g., <code class="language-plaintext highlighter-rouge">5432</code>), in the <code class="language-plaintext highlighter-rouge">Credentials</code> configuration interface as shown below (the <code class="language-plaintext highlighter-rouge">Host</code> box should be replaced by the domain name or IP address of our server hosting the <code class="language-plaintext highlighter-rouge">postgres</code> database),</p>

<p align="center">
<img src="/assets/img/posts/n8n_postgres.png" style="border:none;" width="1000" alt="n8n_postgres" title="n8n_postgres" />
</p>

<p>However, if we cannot open the port for <code class="language-plaintext highlighter-rouge">postgres</code> on our server like in my case, we can go with the local connection ‚Äì basically, we have both the <code class="language-plaintext highlighter-rouge">n8n</code> and <code class="language-plaintext highlighter-rouge">postgres</code> docker containers running on the same server and then we can let them talk to each other locally. To do this, we need to first set up a docker network,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create n8n_local
</code></pre></div></div>

<p>and the <code class="language-plaintext highlighter-rouge">n8n_local</code> here is a name for the network to our choice. After that, we need to bring down the running docker container (if network was not configured while firing up the two containers) first, put in the network configuration like what we have in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file shared above for the two containers, and re-compose the containers. Basically, we do,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /path/to/postgres_or_n8n/folder/where/the/docker-compose.yml/file/is/located
docker compose down
docker compose up <span class="nt">-d</span>
</code></pre></div></div>

<p>In the <code class="language-plaintext highlighter-rouge">YAML</code> file shared above, we have,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networks:
    n8n_local:
        external: true
</code></pre></div></div>

<p>at the very top of the file, telling the composing engine about the <code class="language-plaintext highlighter-rouge">n8n_local</code> local network to use for the composing, and then down below in the <code class="language-plaintext highlighter-rouge">services</code> section, we use the network,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networks:
    - n8n_local
</code></pre></div></div>

<p>To check whether the two containers are using the defined network <code class="language-plaintext highlighter-rouge">n8n_local</code>, we can do,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network inspect n8n_local
</code></pre></div></div>

<p>and in the output, we are expected to see the two containers are included in the list of containers that are using the inspected <code class="language-plaintext highlighter-rouge">n8n_local</code> network. If the network is configured properly for the docker containers, in our <code class="language-plaintext highlighter-rouge">n8n</code> interface for configuring the <code class="language-plaintext highlighter-rouge">Credentials</code> (see the interface screenshot above), we can put in those parameters according to the confiugration for our <code class="language-plaintext highlighter-rouge">postgres</code> database, including the <code class="language-plaintext highlighter-rouge">Host</code>, <code class="language-plaintext highlighter-rouge">Database</code>, etc. We can refer to the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file for <code class="language-plaintext highlighter-rouge">postgres</code> about those information. Specifically for the <code class="language-plaintext highlighter-rouge">Host</code> input, we want to use the container name for <code class="language-plaintext highlighter-rouge">postgres</code>, which is also given in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file shared above (see the <code class="language-plaintext highlighter-rouge">container_name</code> entry). All the other configurations shown in the screenshot above should apply without the need to change. For the <code class="language-plaintext highlighter-rouge">SSL</code> connection, I disable it in this case since the connection is going to be local only.</p>

<blockquote>
  <p>Some useful information about using <code class="language-plaintext highlighter-rouge">postgres</code> database with OpenAI and Ollama can be found in Refs. [7, 8].</p>
</blockquote>

<p><br /></p>

<h1 id="references">References</h1>

<p>[1] <a href="https://n8n.io/workflows/5993-create-a-documentation-expert-bot-with-rag-gemini-and-supabase/">https://n8n.io/workflows/5993-create-a-documentation-expert-bot-with-rag-gemini-and-supabase/</a></p>

<p>[2] <a href="https://dev.to/yukaty/setting-up-postgresql-with-pgvector-using-docker-hcl">https://dev.to/yukaty/setting-up-postgresql-with-pgvector-using-docker-hcl</a></p>

<p>[3] <a href="https://community.n8n.io/t/error-in-certificate-creation-due-to-directory-permissions/188027/2">https://community.n8n.io/t/error-in-certificate-creation-due-to-directory-permissions/188027/2</a></p>

<p>[4] <a href="https://docs.n8n.io/hosting/installation/server-setups/docker-compose/#next-steps">https://docs.n8n.io/hosting/installation/server-setups/docker-compose/#next-steps</a></p>

<p>[5] <a href="https://iris2020.net/2023-02-15-notes_mybb/">https://iris2020.net/2023-02-15-notes_mybb/</a></p>

<p>[6] <a href="https://community.n8n.io/t/solved-connection-lost-in-workflow-editor/113110">https://community.n8n.io/t/solved-connection-lost-in-workflow-editor/113110</a></p>

<p>[7] <a href="https://dev.to/yukaty/getting-started-with-vector-search-part-2-3amh">https://dev.to/yukaty/getting-started-with-vector-search-part-2-3amh</a></p>

<p>[8] <a href="https://dev.to/yukaty/part-3-implementing-vector-search-with-ollama-1dop">https://dev.to/yukaty/part-3-implementing-vector-search-with-ollama-1dop</a></p>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#web">web</a>
          
            <a href="/tags#server">server</a>
          
            <a href="/tags#LLM">LLM</a>
          
            <a href="/tags#database">database</a>
          
            <a href="/tags#RAG">RAG</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a target="_blank" href="https://twitter.com/intent/tweet?text=Set+up+n8n+and+postgres+for+Retrieval+Augmented+Generation+%28RAG%29+using+the+local+vector+database&url=http%3A%2F%2Flocalhost%3A4000%2F2025-11-19-n8n_postgres_embed%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2025-11-19-n8n_postgres_embed%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2025-11-19-n8n_postgres_embed%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2025-10-26-bondstr_bvs/" data-toggle="tooltip" data-placement="top" title="Bond Valence Energy Landscape Calculation with the BondStr Program in Fullprof Suite">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2025-11-30-metropolis_monte_carlo/" data-toggle="tooltip" data-placement="top" title="About the Metropolis Monte Carlo Method">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  <div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_shortname = &quot;rmcprofile&quot;;
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://rmcprofile.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row column_top">
        <div class="col-xl-10 offset-xl-1 col-lg-10 offset-lg-1">
        <h3>External Links</h3>
        </div>
    </div>
    <div class="row" style="margin-bottom:10px">
        <div class="col-xl-10 offset-xl-1 col-lg-10 offset-lg-1">
      <div class="column" style="background-color:#EAEAEA;">
        <h4>Monte Carlo</h4>
				<a target="_blank" href="https://tproffen.github.io/DiffuseCode/">DISCUS</a>
				</br>
				<a target="_blank" href="https://www.szfki.hu/~nphys/rmc++/opening.html">RMC++</a>
				</br>
				<a target="_blank" href="https://research.csiro.au/mmm/hrmc/">HRMC</a>
				</br>
				<a target="_blank" href="https://bachiraoun.github.io/fullrmc/">fullrmc</a>
				</br>
        <a target="_blank" href="http://www.dragon.lv/exafs/rmc.htm">RMC for EXAFS</a>
        </br>
        <a target="_blank" href="https://www.isis.stfc.ac.uk/Pages/Empirical-Potential-Structure-Refinement.aspx">EPSR</a>
				</br>
				<a target="_blank" href="https://rmcprofile.ornl.gov/">RMCProfile website</a>
				</br>
				<a target="_blank" href="http://www.rmcprofile.org/Main_Page">RMCProfile website - legacy</a>
				</br>
				<a target="_blank" href="https://en.wikipedia.org/wiki/Reverse_Monte_Carlo">Wikipedia for RMC</a>
      </div>
      <div class="column" style="background-color:#EAEAEA;">
        <h4>Rietveld-like</h4>
        <a target="_blank" href="https://www.diffpy.org/products/pdfgui.html">PDFgui</a>
        </br>
        <a target="_blank" href="https://www.diffpy.org/products/diffpycmi/index.html">DIFFPy-CMI</a>
        </br>
        <a target="_blank" href="https://www.diffpy.org/products/mPDF.html">magnetic PDF</a>
        </br>
        <a target="_blank" href="https://topas.webspace.durham.ac.uk/tutorial_pdf_sno2/">Topas for PDF</a>
      </div>
      <div class="column" style="background-color:#EAEAEA;">
        <h4>Tools</h4>
        <a target="_blank" href="http://addie.ornl.gov/">ADDIE</a>
        </br>
				<a target="_blank"
						href="http://li.mit.edu/Archive/Graphics/A/">Atomeye</a>
				</br>
				<a target="_blank"
						href="https://sourceforge.net/projects/xming/">Xming</a>
				</br>
				<a target="_blank"
						href="https://www.mantidproject.org/Main_Page">Mantid</a>
				</br>
				<a target="_blank" href="https://www.facebook.com/disord.matt">GUDRUN</a>
				</br>
				<a target="_blank"
						href="https://www.diffpy.org/products/pdfgetx.html">PDFGet..
						</a>
				</br>
				<a target="_blank" href="https://www.ncnr.nist.gov/resources/n-lengths/">Neutron scattering length</a>
				</br>
				<a target="_blank" href="http://wwwisis2.isis.rl.ac.uk/reference/Xray_scatfac.htm">X-ray form factor</a>
				</br>
				<a target="_blank" href="https://www.webelements.com/">Web elements</a>
				</br>
				<a target="_blank" href="https://ptable.com/#Properties">Dynamic
						periodic table</a>
				</br>
				<a target="_blank" href="http://wwwisis2.isis.rl.ac.uk/disordered/Manuals/ATLAS/atlas_values.htm">ISIS values</a>
				</br>
      </div>
      <div class="column" style="background-color:#EAEAEA;">
        <h4>Facilities</h4>
				<a target="_blank" href="https://neutrons.ornl.gov/nomad">US - ORNL - NOMAD</a>
        </br>
				<a target="_blank" href="https://neutrons.ornl.gov/powgen">US - ORNL -
						POWGEN</a>
				</br>
				<a target="_blank" href="https://www.aps.anl.gov/Beamlines/Directory/Details?beamline_id=16">US - APS - 11-ID-B</a>
				</br>
				<a target="_blank" href="https://www.bnl.gov/ps/beamlines/beamline.php?r=28-ID-1">US - BNL - 28-ID-1</a>
				</br>
				<a target="_blank"
						href="https://www.isis.stfc.ac.uk/Pages/Gem.aspx">UK - ISIS - GEM</a>
				</br>
				<a target="_blank" href="https://www.isis.stfc.ac.uk/Pages/polaris.aspx">UK - ISIS - Polaris</a>
				</br>
				<a target="_blank" href="https://www.diamond.ac.uk/Instruments/Crystallography/I15-1.html">UK - Diamond - I15-1</a>
				</br>
				<a target="_blank" href="https://mlfinfo.jp/en/bl21/">Japan - J-PARC - NOVA</a>
				</br>
				<a target="_blank" href="http://www.spring8.or.jp/wkg/BL14B1/instrument/lang-en/INS-0000000309/instrument_summary_view">Japan - SPRING8 - BL14B1</a>
				</br>
				<a target="_blank" href="http://www.spring8.or.jp/wkg/BL22XU/instrument/lang-en/INS-0000000327/instrument_summary_view">Japan - SPRING8 - BL22XU</a>
				</br>
				<a target="_blank" href="https://europeanspallationsource.se/instruments/heimdal">Europe - ESS - HEIMDAL</a>
      </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 footer_bottom">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a target="_blank" href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a target="_blank" href="mailto:zhangy3@ornl.gov" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a target="_blank" href="https://github.com/kvieta1990" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a target="_blank" href="https://reddit.com/u/apw247" title="Reddit">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-reddit fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Reddit</span>
   </a>
  </li><li class="list-inline-item">
    <a target="_blank" href="https://linkedin.com/in/yuanpeng-zhang-11bb503a" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li><li class="list-inline-item">
   <a target="_blank" href="https://orcid.org/0000-0003-4224-3361" title="ORCID">
     <span class="fa-stack fa-lg" aria-hidden="true">
       <i class="fas fa-circle fa-stack-2x"></i>
       <i class="fab fa-orcid fa-stack-1x fa-inverse"></i>
     </span>
     <span class="sr-only">ORCID</span>
   </a>
 </li><li class="list-inline-item">
    <a target="_blank" href="https://scholar.google.com/citations?user=NgqIgO0AAAAJ&hl=en" title="Google Scholar">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fa fa-graduation-cap fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Google Scholar</span>
    </a>
  </li></ul>

      
      <p class="copyright text-muted">

      
      </p>
      <p class="theme-by text-muted">
        Copyright 2025 ¬©
        <a>Yuanpeng Zhang</a>
      </p>
      </div>
    </div>
	<div class="row" id="vistor_map" style="position:absolute; left:-10px; bottom:20px;">
	  <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=000000&w=300&t=tt&d=mXrA2cjTFPms32CLvpbXJeN7mGr8Pp6J7WRX3Im-ZOw&co=eaeaea&ct=000000'></script>
	</div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
